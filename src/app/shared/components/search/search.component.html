<section class="search-section">
  <div class="search-hero">
    <h1 class="search-title">
      Trouvez le bien
      <span class="highlight">idéal</span>
    </h1>
    <p class="search-subtitle">
      Appartements, maisons, terrains... Découvrez nos annonces immobilières
    </p>
  </div>

  <form class="search-form" (ngSubmit)="onSubmit()">
    <!-- Contract Type Tabs -->
    <div class="contract-tabs">
      @for (ct of contractTypes; track ct.value) {
        <button
          type="button"
          class="contract-tab"
          [class.active]="contractType() === ct.value"
          (click)="updateContractType(ct.value ?? '')"
        >
          {{ ct.label }}
        </button>
      }
    </div>

    <div class="search-main">
      <div class="search-input-wrapper">
        <svg class="search-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
        <input
          type="text"
          class="search-input"
          placeholder="Ville, code postal, référence..."
          [ngModel]="query()"
          (ngModelChange)="updateQuery($event)"
          name="query"
          aria-label="Rechercher une ville, code postal ou référence"
        />
      </div>

      <button type="button" class="filter-toggle" [class.active]="hasActiveFilters" (click)="toggleFilters()" [attr.aria-expanded]="showFilters()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="4" y1="21" x2="4" y2="14"/>
          <line x1="4" y1="10" x2="4" y2="3"/>
          <line x1="12" y1="21" x2="12" y2="12"/>
          <line x1="12" y1="8" x2="12" y2="3"/>
          <line x1="20" y1="21" x2="20" y2="16"/>
          <line x1="20" y1="12" x2="20" y2="3"/>
          <line x1="1" y1="14" x2="7" y2="14"/>
          <line x1="9" y1="8" x2="15" y2="8"/>
          <line x1="17" y1="16" x2="23" y2="16"/>
        </svg>
        <span>Filtres</span>
        @if (hasActiveFilters) {
          <span class="filter-badge"></span>
        }
      </button>

      <button type="submit" class="search-btn">
        <span>Rechercher</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </button>
    </div>

    @if (showFilters()) {
      <div class="search-filters">
        <div class="filters-grid">
          <div class="filter-group">
            <label class="filter-label" for="property-type">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
              </svg>
              Type de bien
            </label>
            <select
              id="property-type"
              class="filter-select"
              [ngModel]="placeType() ?? ''"
              (ngModelChange)="updatePlaceType($event)"
              name="placeType"
            >
              @for (type of propertyTypes; track type.value) {
                <option [value]="type.value ?? ''">{{ type.label }}</option>
              }
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label" for="price-range">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
              </svg>
              Budget
            </label>
            <select
              id="price-range"
              class="filter-select"
              [ngModel]="getPriceRangeValue()"
              (ngModelChange)="updatePriceRange($event)"
              name="priceRange"
            >
              @for (range of currentPriceRanges; track range.label) {
                <option [value]="range.min + '-' + range.max">{{ range.label }}</option>
              }
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label" for="surface-range">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <path d="M3 9h18M9 21V9"/>
              </svg>
              Surface
            </label>
            <select
              id="surface-range"
              class="filter-select"
              [ngModel]="getSurfaceRangeValue()"
              (ngModelChange)="updateSurfaceRange($event)"
              name="surfaceRange"
            >
              @for (range of surfaceRanges; track range.label) {
                <option [value]="range.min + '-' + range.max">{{ range.label }}</option>
              }
            </select>
          </div>
        </div>

        @if (hasActiveFilters) {
          <div class="filters-footer">
            <button type="button" class="clear-filters-btn" (click)="clearFilters()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
              Effacer les filtres
            </button>
          </div>
        }
      </div>
    }
  </form>
</section>
